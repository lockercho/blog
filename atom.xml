<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>PY éƒ¨è½æ ¼</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-07-26T22:13:20.765Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Pei-Ya Chiu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Observability ä¸‰æœ¬æŸ±ä¹‹ Distributed Tracing ä»‹ç´¹</title>
    <link href="http://yoursite.com/2020/07/26/distributed-tracing-1/"/>
    <id>http://yoursite.com/2020/07/26/distributed-tracing-1/</id>
    <published>2020-07-26T19:42:46.000Z</published>
    <updated>2020-07-26T22:13:20.765Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å·¥ä½œä¸­ä½¿ç”¨åˆ°äº† <strong>Distributed Tracing</strong>ï¼ˆåˆ†æ•£å¼è¿½è¹¤ï¼‰ï¼Œç™¼ç¾ Distributed Tracing å°æ–¼ Microservices çš„ç¶­è­·èˆ‡é–‹ç™¼æ˜¯éå¸¸å¥½ç”¨ä¸”é‡è¦çš„æŠ€è¡“ã€‚</p><p>é›–ç„¶ <strong>Logging</strong>ã€<strong>Metrics</strong> åŠ <strong>Distributed Tracing</strong> è¢«ä¸¦ç¨±ç‚º <a href="https://www.scalyr.com/blog/three-pillars-of-observability/" target="_blank" rel="noopener">Observability ä¸‰æœ¬æŸ±</a>ï¼ŒDistributed Tracing å¾—åˆ°çš„é—œæ³¨åº¦å»ä¸å¦‚å‰å…©è€…ã€‚åŸå› å¯èƒ½æ˜¯ Logging èˆ‡ Metric åœ¨ Monolith System ä¸­å³è¢«å¤§é‡ä½¿ç”¨ï¼ŒDistributed Tracing å»æ˜¯å»ºç«‹åœ¨ Microservice å‰æä¹‹ä¸‹ï¼Œæ™®åŠåº¦è‡ªç„¶æ¯”ä¸ä¸Šå‰å…©è€…ã€‚</p><p>è€Œé€™æ®µæ™‚é–“åœ¨å­¸ç¿’èˆ‡å¯¦ä½œ Distributed Tracing æ™‚ï¼Œä¹Ÿç™¼ç¾ç¹é«”ä¸­æ–‡çš„ç›¸é—œè³‡æ–™æœ‰é»å°‘ï¼Œå› æ­¤æ±ºå®šå¯«å€‹ç³»åˆ—æ–‡ä»‹ç´¹ Distributed Tracingï¼Œä¹Ÿç•¶ä½œæ˜¯è‡ªå·±çš„å·¥ä½œç­†è¨˜ã€‚</p><h2 id="ä½•è¬‚-Distributed-Tracingï¼Ÿ"><a class="header-anchor" href="#ä½•è¬‚-Distributed-Tracingï¼Ÿ"></a>ä½•è¬‚ Distributed Tracingï¼Ÿ</h2><p><strong><code>Distributed Tracing</code></strong>ï¼Œç°¡å–®çš„ä¾†èªªå°±æ˜¯åœ¨ç›£æ§ request åœ¨ distributed system æˆ–æ˜¯ microservices ä¸­çš„è¡Œç‚ºçš„æŠ€è¡“ã€‚ä¸€å€‹ <strong><code>Trace</code></strong>ï¼ˆè¿½è¹¤ï¼‰æ˜¯ç”¨ä¾†æè¿°ç¶²è·¯æœå‹™åœ¨å›æ‡‰ä¸€å€‹ request æ™‚è§¸ç™¼çš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œé€™äº›äº‹ä»¶å¯èƒ½è·¨è¶Šäº†ä¸åŒ process ã€network boundary æˆ–æ˜¯ subsystem boundaryã€‚</p><p><strong>&quot;Distributed&quot;</strong> Tracing ç‚ºä½•é‡è¦ï¼Ÿä»¥å¾€åœ¨ Monolith System æ¶æ§‹æ™‚ï¼Œåªè¦åœ¨ log ä¸­è¨˜éŒ„å¥½ç›¸é—œçš„ request-idï¼Œå°±èƒ½å¾ logging system ä¸­ç›£æ§èˆ‡åˆ†ææ¯å€‹ request çš„ç‹€æ³ã€‚è€Œåœ¨ microservice çš„æ¶æ§‹ä¸­ï¼Œä¸€å€‹æœå‹™å¾€å¾€èƒŒå¾Œæœƒç”¨åˆ°å¤šå€‹ä¸åŒçš„å­æœå‹™ï¼Œé€™æ™‚è‹¥æ²’æœ‰å°è¨˜éŒ„ä¸‹ä¾†çš„ log åšé¡å¤–è™•ç†ï¼Œlogging system æœƒå¤±å»åŒå€‹ request åœ¨ä¸åŒæœå‹™ä¹‹é–“çš„é€£çµã€‚</p><p>Distributed Tracing å°±æ˜¯ç‚ºäº†è§£æ±ºæ­¤å•é¡Œè€Œèª•ç”Ÿçš„ã€‚</p><h2 id="è§€å¿µä»‹ç´¹"><a class="header-anchor" href="#è§€å¿µä»‹ç´¹"></a>è§€å¿µä»‹ç´¹</h2><p>åœ¨ Distributed Tracing ä¸­ï¼Œ<strong>ä¸€å€‹ <code>Trace</code> æè¿°äº†ä¸€å€‹ request åœ¨å¤šå€‹å­æœå‹™ä¸­çš„ä¸åŒéšæ®µåˆ†åˆ¥è§¸ç™¼çš„ä¸€è‡³å¤šå€‹ event</strong>ã€‚ç‚ºäº†è¨˜éŒ„äº‹ä»¶åœ¨è·¨æœå‹™é–“çš„å¾å±¬é—œä¿‚ä»¥åŠç™¼ç”Ÿé †åºï¼Œ Distributed Tracing è¦ç¯„äº†ä¸€ç³»åˆ—çš„ headersï¼ˆä»¥ HTTP ç‚ºä¸»ï¼Œä½†ä¹Ÿæœ‰ queue èˆ‡ RPC çš„å¯¦ä½œï¼‰ï¼Œæ¯å€‹å­æœå‹™å¿…é ˆè¦ä¹–ä¹–æ”¶é›†é€™äº› headersï¼Œä¸¦åœ¨å°å­æœå‹™é€ request æ™‚ä¸€è·¯ propagate ï¼ˆå‚³éï¼‰çµ¦æ‰€æœ‰å­æœå‹™ã€‚</p><p><strong><code>Trace</code></strong>ï¼ˆè¿½è¹¤ï¼‰èˆ‡ <strong><code>Span</code></strong>ï¼ˆè·¨åº¦ï¼Œä¸­æ–‡å¥½åƒå¾ˆå°‘ç”¨åˆ°é€™å€‹è©ï¼‰æ˜¯ Distributed Tracing è£¡æœ€é‡è¦çš„å…©å€‹å…ƒä»¶ã€‚æ¯å€‹ Span é‚„æœƒå¸¶æœ‰ä¸€å€‹ <strong><code>SpanContext</code></strong> æè¿° Span ä¹‹é–“å…±ç”¨çš„ç‹€æ…‹ã€‚</p><h3 id="Trace"><a class="header-anchor" href="#Trace"></a>Trace</h3><p><strong><code>Trace</code></strong> ç”¨ä¾†æè¿°ä¸€å€‹ requestï¼Œç”±ä¸€åˆ°å¤šå€‹  <strong><code>Span</code></strong> çµ„æˆã€‚</p><h3 id="Span"><a class="header-anchor" href="#Span"></a>Span</h3><p><strong><code>Span</code></strong> ç‚ºåœ¨å„æœå‹™ä¸­ç™¼ç”Ÿçš„å¤šå€‹ä¸åŒéšæ®µçš„è³‡è¨Šï¼Œä¸€å€‹ Span åŒ…å«äº†ä»¥ä¸‹è³‡æ–™ï¼š</p><ul><li>äº‹ä»¶åç¨±</li><li>é–‹å§‹èˆ‡çµæŸæ™‚é–“</li><li>Attributesï¼ˆå±¬æ€§ï¼‰ï¼šä¸€ç³»åˆ—çš„ key-value</li><li>é›¶åˆ°å¤šå€‹äº‹ä»¶è³‡æ–™ï¼Œæ¯å€‹äº‹ä»¶ä¹ŸæœƒåŒ…å«è‡ªå·±çš„ Name, Timestamp åŠ Attributes</li><li>Parent Span ID</li><li>é€£çµåˆ°é›¶æˆ–å¤šå€‹ Span</li><li>SpanContext ID</li></ul><h3 id="SpanContext"><a class="header-anchor" href="#SpanContext"></a>SpanContext</h3><p><strong><code>SpanContext</code></strong> ä¸­åŒ…å«äº†è­˜åˆ¥ Span çš„è³‡è¨Šï¼Œä¹Ÿè² è²¬å‚³é parent span è¨­å®šçš„ optionsã€‚</p><ul><li><strong>Trace ID</strong>ï¼šTrace çš„ IDï¼Œç‚ºéš¨æ©Ÿç”¢ç”Ÿçš„ 16 bytes å€¼ï¼Œç”¨ä¾† group è·¨è¶Šæœå‹™é‚Šç•Œçš„æ‰€æœ‰å±¬æ–¼åŒå€‹ Trace çš„ Spansã€‚</li><li><strong>Span ID</strong>ï¼šSpan çš„ IDï¼Œç‚ºéš¨æ©Ÿç”¢ç”Ÿçš„ 8 bytes å€¼ï¼Œç”¨ä¾†è­˜åˆ¥ Spanã€‚ç•¶ SpanID è¢«å‚³éè‡³å­ Span æ™‚ï¼ŒSpanID æœƒæˆç‚ºå­ Span ä¸­çš„ Parent Span IDã€‚</li><li><strong>TraceFlags</strong>ï¼šTrace çš„ optionsã€‚ï¼Œç‚º 1 byte å€¼ï¼ˆå« 8 bitï¼‰ï¼Œç›®å‰åªå®šç¾©äº† Sampling Bit (0x1)ï¼Œä»£è¡¨æ­¤ Trace æ˜¯å¦æœ‰è¢« sampleï¼ˆå–æ¨£ï¼‰åˆ°ã€‚</li><li><strong>TraceState</strong>ï¼šTraceState è®“ vendor èƒ½å¤¾å¸¶è‡ªè¡Œå®šç¾©çš„ key-value pairsï¼Œèƒ½ç”¨ä¾†å½ˆæ€§çš„å‚³éé¡å¤–çš„è³‡è¨Šæˆ–æ˜¯è™•ç† legacy fieldã€‚</li></ul><h2 id="Trace-ç¯„ä¾‹"><a class="header-anchor" href="#Trace-ç¯„ä¾‹"></a>Trace ç¯„ä¾‹</h2><p>å‡è¨­æœ‰ä¸€å€‹æœå‹™ç”± 5 å€‹å­æœå‹™çµ„æˆï¼Œæœå‹™é–“ä½¿ç”¨ RPC ï¼ˆRemote Procedure Callï¼‰æºé€šï¼Œæ¶æ§‹å¦‚ä¸‹åœ–ï¼š</p><div style="text-align:center;padding: 20px 0;"><figure class="image"><img style="width:50%;margin-bottom:22px;" src="/blog/2020/07/26/distributed-tracing-1/services.png">  <figcaption>Figure 1. Example distributed system</figcaption></figure></div><p>è¦ç‚ºé€™å€‹æœå‹™è¨­è¨ˆ Distributed Tracingï¼Œæœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯å°æ¯å€‹å­æœå‹™ç”¢ç”Ÿä¸€å€‹ Spanï¼Œæ¯æ¬¡ Request æœƒå¾—åˆ° 1 å€‹ Traceï¼ŒTrace ä¸­åŒ…å«äº† 5 å€‹ã€‚</p><p>Distributed Tracing ä¸­æœ‰ä¸»è¦æœ‰å…©ç¨®è¦–è¦ºåŒ–çš„æ–¹å¼ï¼š<strong>Directed Acyclic Graph (DAG)</strong> æˆ–æ˜¯ <strong>Time-based Gragh</strong>ã€‚</p><h3 id="DAG-View-of-Trace"><a class="header-anchor" href="#DAG-View-of-Trace"></a>DAG View of Trace</h3><p>Trace ä¹Ÿå¯ä»¥è¢«ç†è§£ç‚ºç”±å¤šå€‹ Span çµ„æˆçš„æœ‰å‘ç„¡ç’°åœ–ï¼ˆDirected acyclic graphï¼Œç°¡ç¨± DAGï¼‰ï¼Œå¦‚ä¸‹åœ–ï¼š</p><div style="text-align:center;width:100%;"><figure class="image"><img style="width:50%;margin-bottom:0px;" src="/blog/2020/07/26/distributed-tracing-1/span-DAG.png">  <figcaption>Figure 2. DAG View of a Trace </figcaption></figure></div><p>ä¸»æœå‹™ A æ”¶åˆ° request æ™‚ï¼Œrequest header æœƒå¸¶æœ‰ä¸€å€‹åœ¨ç³»çµ±ä¸­å”¯ä¸€çš„ TraceIDï¼Œé€™å€‹ TraceID å¯ä»¥åœ¨æœå‹™çš„ Infrastructure å±¤ç”¢ç”Ÿï¼ˆä¾‹å¦‚åœ¨ K8S ä¸­å¯ä»¥ä½¿ç”¨ <a href="https://istio.io/latest/docs/tasks/observability/distributed-tracing/overview/" target="_blank" rel="noopener">Istio ä¾†æ³¨å…¥</a>ï¼‰ã€‚è‹¥ TraceID ä¸å­˜æ–¼ request ä¸­ï¼Œå‰‡ A éœ€è‡ªè¡Œç”¢ç”Ÿä¸€å€‹ IDã€‚TraceID åŠå…¶ä»–çš„è³‡è¨Šï¼ˆMetadataï¼‰æœƒä»¥ key-value çš„å½¢å¼å­˜åœ¨ SpanContext ä¸­ã€‚ç³»çµ±ä¸­æ‰€æœ‰å­æœå‹™åœ¨æºé€šæ™‚å¿…é ˆå‚³éåŒä¸€å€‹ SpanContext è‡³ä¸‹ä¸€å€‹æœå‹™ã€‚</p><p>ä¸€å€‹æœå‹™å¯ä»¥æ ¹æ“šéœ€è¦è‡ªè¡Œç”¢ç”Ÿå¤šå€‹ Span ä»¥æ¨™è¨»ç¨‹å¼ä¸­ä¸åŒçš„éšæ®µã€‚ä½†æ ¹æ“šç›®å‰æœ€ä¸»æµçš„åˆ†æ•£å¼è¿½è¹¤çš„å·¥å…· OpenTelemetry çš„å¯¦ä½œï¼Œç•¶ Trace è·¨è¶Šæœå‹™é‚Šç•Œæ™‚ï¼Œå¿…é ˆç”¢ç”Ÿæ–°çš„ Spanï¼Œä¹Ÿå°±æ˜¯åŒå€‹ Span æ˜¯ä¸èƒ½è·¨è¶Šæœå‹™é‚Šç•Œçš„ï¼ˆæœå‹™é‚Šç•ŒåŒ…å«äº† process boundary, network ç­‰ç­‰ï¼‰</p><h3 id="Time-based-View-of-Trace"><a class="header-anchor" href="#Time-based-View-of-Trace"></a>Time-based View of Trace</h3><p>é™¤äº† DAG åœ–ä»¥å¤–ï¼ŒSpan ä¹Ÿç¶“å¸¸è¢«è¦–è¦ºåŒ–åœ¨æ™‚é–“è»¸ä¸Šï¼Œå¦‚ä¸‹åœ–ï¼š</p><div style="text-align:center;width:100%;"><figure class="image"><img style="width:70%;margin-bottom:0px;" src="/blog/2020/07/26/distributed-tracing-1/sync-services.png">  <figcaption>Figure 4. Time-based View of Trace - åŒæ­¥å–ç”¨ D, E </figcaption></figure></div><p>ä»¥æ™‚é–“è»¸é¡¯ç¤º trace æ™‚ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹å‡º request åœ¨æ¯å€‹å­ç³»çµ±ä¸­è¢«è™•ç†çš„å…ˆå¾Œé †åºèˆ‡èŠ±è²»æ™‚é–“ï¼Œé€²è€Œå°æ½›åœ¨çš„å„ªåŒ–æ–¹å¼æä¾› insightã€‚</p><p>ä»¥ B æœå‹™ç‚ºä¾‹ï¼Œè‹¥æ”¹ä»¥éåŒæ­¥ï¼ˆasynchronousï¼‰å–ç”¨ D, E æœå‹™ï¼Œèƒ½å¤ æœ‰æ•ˆç¸®çŸ­ b çš„ durationï¼Œé€²è€Œç¸®çŸ­æ•´é«” a çš„ durationï¼Œå¦‚ä¸‹åœ–ï¼š</p><div style="text-align:center;width:100%;"><figure class="image"><img style="width:70%;margin-bottom:0px;" src="/blog/2020/07/26/distributed-tracing-1/async-services.png">  <figcaption>Figure 5. Time-based View of Trace - éåŒæ­¥å–ç”¨ D, E </figcaption></figure></div><p>ä¸€èˆ¬è€Œè¨€ï¼ŒTime-based çš„è¦–è¦ºåŒ–æœƒæ¯” DAG æ›´å¸¸ç”¨åˆ°ï¼Œä¹Ÿæ˜¯ <a href="https://www.jaegertracing.io/docs/1.18/" target="_blank" rel="noopener">Jaeger</a> é€™å€‹ Trace æ”¶é›†ç³»çµ±é è¨­çš„è¦–è¦ºåŒ–æ–¹å¼ã€‚</p><h2 id="Sampleï¼ˆå–æ¨£ï¼‰"><a class="header-anchor" href="#Sampleï¼ˆå–æ¨£ï¼‰"></a>Sampleï¼ˆå–æ¨£ï¼‰</h2><p>é›–ç„¶åˆ†æ•£å¼è¿½è¹¤ç”¢ç”Ÿä¸€å€‹ Span çš„å»¶é²æ¥µä½ï¼ˆnano second ç­‰ç´šï¼‰ï¼Œä½†æ˜¯å°æ–¼è·¨å¤šå€‹å­æœå‹™çš„é«˜ä½µç™¼ä½å»¶é²æœå‹™ï¼Œé–‹å•Ÿ Tracing èƒ½é€ æˆçš„ Performance Impact ä¾ç„¶æ˜¯å¾ˆå¯è§€çš„ã€‚å› æ­¤å¯¦å‹™ä¸Šä¾†èªªä¸ä¸€å®šæœƒè¨˜éŒ„æ‰€æœ‰ Request çš„ Traceï¼Œè€Œæ˜¯ä½¿ç”¨ Sampleï¼ˆå–æ¨£ï¼‰çš„æ©Ÿåˆ¶é¸æ“‡æ€§è¨˜éŒ„ã€‚</p><p>ä¸‹é¢è¡¨æ ¼æ˜¯ Google åœ¨ 2010 æå‡ºçš„ paper <a href="https://research.google/pubs/pub36356/" target="_blank" rel="noopener">â€œDapper, a Large-Scale Distributed Systems Tracing Infrastructureâ€</a> ï¼ˆå¼·çƒˆæ¨è–¦é–±è®€åŸæ–‡ï¼Œæ­¤ paper å®šç¾©äº†ç¾ä»£ Distributed Tracing æ¶æ§‹ï¼‰ä¸­ï¼Œå°æ–¼ç•¶æ™‚å…§éƒ¨ä½¿ç”¨çš„åˆ†æ•£å¼è¿½è¹¤å·¥å…· Dapper æ‰€åšçš„æ•ˆèƒ½æ¸¬è©¦ï¼š</p><div style="text-align:center;width:100%;"><figure class="image"><img style="width:50%;margin-bottom:0px;" src="/blog/2020/07/26/distributed-tracing-1/tracing-perf.png">  <figcaption>Table 1. Performance Benchmark of Dapper </figcaption></figure></div><p>åœ¨é€™å€‹æ¸¬è©¦ä¸­ï¼ŒGoogle å°è‡ªå®¶çš„æœå°‹å¼•æ“ API åŠ ä¸Š Distributed Tracingï¼Œä¸¦è¨­å®šä¸åŒçš„ Sampling frequencyï¼ˆå–æ¨£é »ç‡ï¼‰ä¾†è§€å¯Ÿæ•ˆèƒ½å½±éŸ¿ã€‚åœ¨ Sampling rate ç‚º 1 æ™‚ï¼ˆæ„å³è¨˜éŒ„æ‰€æœ‰ Requests çš„ trace ï¼‰ï¼Œå¹³å‡ latency å¢åŠ äº† <strong>16.3%</strong> ä¹‹å¤šï¼Œä¹‹å¾Œ Latency change % éš¨è‘— Sampling Rate é™ä½è€Œé™ä½ã€‚è€Œæ ¹æ“š paper çš„èªªæ˜ï¼ŒæŠŠ Sampling rate é™è‡³ <strong>1/16</strong> ä»¥ä¸‹å¾Œï¼ŒTracing å°æ•ˆèƒ½é€ æˆçš„å½±éŸ¿å°±æ²’æœ‰é‚£éº¼é¡¯è‘—äº†ã€‚ï¼ˆå¦å¤–ï¼ŒPaper ä¸­ä¹Ÿæåˆ°äº† Latency èˆ‡ Throughput çš„å¯¦é©—èª¤å·®å€‹åˆ¥æ˜¯ 2.5% åŠ 0.15%ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼è¡¨æ ¼ä¸­çš„ Latency change % åœ¨ Sampling rate = 1/1024 æ™‚æœƒæ˜¯è² çš„ã€‚ï¼‰</p><h3 id="Sampling-Rate-è¨­å®šå¤šå°‘å¥½ï¼Ÿ"><a class="header-anchor" href="#Sampling-Rate-è¨­å®šå¤šå°‘å¥½ï¼Ÿ"></a>Sampling Rate è¨­å®šå¤šå°‘å¥½ï¼Ÿ</h3><p>é€™å€‹æ•ˆèƒ½æ¸¬è©¦çš„çµæœæ˜¯å¦ä»£è¡¨æˆ‘å€‘ä¸è©²ä½¿ç”¨ Sampling Rate = 1 å‘¢ï¼Ÿæˆ‘èªç‚ºä¸æ˜¯ã€‚å‰é¢ä¹Ÿæåˆ°äº†ç”¢ç”Ÿä¸€å€‹ Span åªéœ€è¦å¹¾ nano second è€Œå·²ï¼Œè€Œ Google çš„å¯¦é©—çµæœå° latency å½±éŸ¿å¦‚æ­¤é¡¯è‘—ï¼Œæˆ‘æƒ³èƒŒå¾Œå¯èƒ½åŸå› ç‚ºï¼š</p><ol><li>Google æœå°‹ API åŸæœ¬æ•ˆèƒ½å°±å¾ˆå¥½ï¼Œå»¶é²å¾ˆä½ï¼Œæ‰€ä»¥ç®—å‡ºä¾†çš„ change  % å°±æœƒæ¯”è¼ƒé«˜ã€‚</li><li>æ­¤ API çš„èƒŒå¾Œå¯èƒ½é€šéäº†å¾ˆå¤šå€‹å­æœå‹™ï¼Œå› æ­¤æœƒç”¢ç”Ÿå¾ˆå¤š spanï¼Œå¢åŠ äº†è¼ƒå¤š latencyã€‚</li></ol><p>Sampling Rate æ‡‰è©²è¨­ç‚ºå¤šå°‘ï¼Ÿé€™å€‹å•é¡Œå¿…é ˆä¾æ“šä½ çš„ç³»çµ±æ¶æ§‹ã€æ•ˆèƒ½éœ€æ±‚ä»¥åŠä½¿ç”¨æƒ…å¢ƒä¾†æ±ºå®šã€‚ä½†ä¸è®Šçš„çœŸç†æ˜¯ï¼š<strong>Benchmark æ˜¯å¥½ç‰©</strong>ï¼Œåœ¨æ±ºå®š Sampling Rate å‰æœ€å¥½æ­é…é©ç•¶çš„æ•ˆèƒ½æ¸¬è©¦ã€å–å¾—æ•¸æ“šä¾†å¹«åŠ©æ±ºç­–ã€‚</p><h3 id="å¦‚ä½•å¯¦ä½œ-Distributed-Tracingï¼Ÿ"><a class="header-anchor" href="#å¦‚ä½•å¯¦ä½œ-Distributed-Tracingï¼Ÿ"></a>å¦‚ä½•å¯¦ä½œ Distributed Tracingï¼Ÿ</h3><p>è¦å°æ‰€æœ‰è·¨æœå‹™çš„ Request å¢åŠ é¡å¤–çš„ Header å…¶å¯¦æ˜¯æ»¿è¾›è‹¦çš„å·¥ä½œï¼Œé¦–å…ˆä¸åŒå­æœå‹™ä¹‹é–“ä¸ä¸€å®šæ˜¯ç”¨ä¸€æ¨£çš„ protocol æºé€šï¼Œç›®å‰æ¯”è¼ƒæµè¡Œçš„æ–¹å¼å°±æœ‰ HTTPã€gRPC æˆ–æ˜¯ Message Queueã€‚ä¸”è‹¥æ˜¯ä¸€å€‹å­æœå‹™å¯¦ä½œ Tracing æ™‚ä¸å°å¿ƒå¯«äº† bug è€Œæ²’æœ‰æ­£ç¢ºå‚³é Headerï¼Œæ•´å€‹ Trace - Span çš„çµæ§‹å°±æœƒä¸­æ–·ã€‚</p><p>ç”±æ–¼ Distributed Tracing çš„æ¢ä»¶æ˜¯å¦‚æ­¤åš´æ ¼ï¼Œæ—©åœ¨ 2010 å¹´ä»¥å‰åˆ†æ•£å¼è¿½è¹¤é‚„æ˜¯ Google è‡ªå·±çš„å…§éƒ¨å°ˆæ¡ˆæ™‚ï¼Œå°±ç¿’æ…£æŠŠ Tracingï¼ˆHeader æ”¶é›†èˆ‡å‚³éï¼‰å¯¦ä½œåœ¨ Web Framework æˆ– Library levelï¼ˆç¨±ç‚º â€œinstrumentâ€ï¼‰ï¼Œä½¿ç”¨è€…åªè¦åœ¨è·Ÿå­æœå‹™äº’å‹•æ™‚ä½¿ç”¨ instrumented library å°±èƒ½å®Œæˆ Tracingã€‚è€Œå¾Œä¾† Open Source ç¤¾ç¾¤çš„å¯¦ä½œï¼Œä¸ç®¡æ˜¯ OpenTracingã€OpenConsensus åˆ°æœ€è¿‘çš„ OpenTelemetryï¼Œéƒ½æœƒç›´æ¥å°è¼ƒæµè¡Œçš„ç¨‹å¼èªè¨€ä»¥åŠè©²èªè¨€ä¸»æµçš„ Web frameworkã€Request library å¯¦ä½œç›¸é—œçš„ instrumented libraryã€‚</p><p>ç°¡å–®ä¸€å¥ç¸½çµå°±æ˜¯ï¼šå…ˆæ‰¾ç¾æœ‰çš„ Tracing library ä¾†ç”¨ï¼ˆä¸¦ä¸”æœ‰å¾ˆå¤§çš„æ©Ÿæœƒä½ å¯ä»¥æ‰¾åˆ°ï¼ï¼‰</p><h2 id="å°çµ"><a class="header-anchor" href="#å°çµ"></a>å°çµ</h2><p>Distributed Tracing æ˜¯å¾ˆå¥½ç”¨çš„æŠ€è¡“ï¼Œç­†è€…æ›¾ç¶“ä½¿ç”¨å®ƒä¾†æ‰¾åˆ°ä¸å°‘ API çš„æ•ˆèƒ½ç“¶é ¸ï¼Œç›´è§€çš„è¦–è¦ºåŒ–æ–¹å¼ä¹Ÿèƒ½å¹«åŠ©åœ˜éšŠæˆå“¡å¿«é€Ÿç†è§£è‡ªå®¶æœå‹™çš„é‹ä½œã€‚</p><p>é›–ç„¶ Distributed Tracing ä»¥å¾€å¾—åˆ°çš„é—œæ³¨åº¦ä¸å¦‚ Logging èˆ‡ Metricsï¼Œä½†è¿‘å¹´ç”±æ–¼ Dockerã€Kubernetes æŠ€è¡“çš„æ™®åŠï¼Œmicroservices ä¹Ÿå¹¾ä¹æ˜¯ç¶²è·¯æœå‹™çš„é è¨­æ¶æ§‹äº†ï¼Œç›¸ä¿¡ä¹‹å¾Œ Distributed Tracing ä¹Ÿæœƒæ¼¸æ¼¸çš„æˆç‚º microservice cluster ä¸­çš„å¿…å‚™å®šç•ªã€‚</p><h2 id="åƒè€ƒè³‡æ–™"><a class="header-anchor" href="#åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul><li>OpenTelemetry Specification:<br><a href="https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/overview.md" target="_blank" rel="noopener">https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/overview.md</a></li><li>â€œDapper, a Large-Scale Distributed Systems Tracing Infrastructureâ€(Google Paper):<br><a href="https://research.google/pubs/pub36356/" target="_blank" rel="noopener">https://research.google/pubs/pub36356/</a></li><li>Istio Distributed Tracing Overview:<br><a href="https://istio.io/latest/docs/tasks/observability/distributed-tracing/overview/" target="_blank" rel="noopener">https://istio.io/latest/docs/tasks/observability/distributed-tracing/overview/</a></li><li>Jaeger - A Distributed Tracing System:<br><a href="https://www.jaegertracing.io/docs/1.18/" target="_blank" rel="noopener">https://www.jaegertracing.io/docs/1.18/</a></li><li>Three Pillars of Observability:<br><a href="https://www.scalyr.com/blog/three-pillars-of-observability/" target="_blank" rel="noopener">https://www.scalyr.com/blog/three-pillars-of-observability/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨å·¥ä½œä¸­ä½¿ç”¨åˆ°äº† &lt;strong&gt;Distributed Tracing&lt;/strong&gt;ï¼ˆåˆ†æ•£å¼è¿½è¹¤ï¼‰ï¼Œç™¼ç¾ Distributed Tracing å°æ–¼ Microservices çš„ç¶­è­·èˆ‡é–‹ç™¼æ˜¯éå¸¸å¥½ç”¨ä¸”é‡è¦çš„æŠ€è¡“ã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶ &lt;strong&gt;Loggi
      
    
    </summary>
    
    
    
      <category term="kubernetes" scheme="http://yoursite.com/tags/kubernetes/"/>
    
      <category term="distributed-tracing" scheme="http://yoursite.com/tags/distributed-tracing/"/>
    
      <category term="observability" scheme="http://yoursite.com/tags/observability/"/>
    
      <category term="opentelemetry" scheme="http://yoursite.com/tags/opentelemetry/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ VS Code + Oketo åœ¨ Kubernetes é ç«¯é–‹ç™¼ - ä»¥ Python ç‚ºä¾‹</title>
    <link href="http://yoursite.com/2020/06/21/okteto-vscode-python/"/>
    <id>http://yoursite.com/2020/06/21/okteto-vscode-python/</id>
    <published>2020-06-21T23:30:46.000Z</published>
    <updated>2020-07-26T22:13:20.769Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ VS Code ä¸Šçš„ <a href="https://marketplace.visualstudio.com/items?itemName=okteto.remote-kubernetes" target="_blank" rel="noopener">Remote - Kubernetes</a> (Okteto) æ’ä»¶ä¾†åœ¨ K8S Cluster å…§é ç«¯é–‹ç™¼ Python applicationã€‚</p><p>ï¼ˆæœ¬æ–‡çš„ç¯„ä¾‹ç¨‹å¼ç¢¼ä¹Ÿå¯ä»¥åœ¨ GitHub æ‰¾åˆ°ï¼š<a href="https://github.com/lockercho/okteto-python-example" target="_blank" rel="noopener">https://github.com/lockercho/okteto-python-example</a> ï¼‰</p><h2 id="Okteto-ä»‹ç´¹"><a class="header-anchor" href="#Okteto-ä»‹ç´¹"></a>Okteto ä»‹ç´¹</h2><p>Okteto é€™å€‹å·¥å…·æœƒå¹«ä½ åœ¨ Kubernetes è¨­å®šå¥½é–‹ç™¼ç”¨çš„ deploymentã€åŒæ­¥æª”æ¡ˆè‡³é ç«¯ã€ä»¥åŠè¨­å®šå®Œæˆå¾Œè‡ªå‹•é–‹å•Ÿ Remote-SSH é€£ç·šè‡³é ç«¯ç’°å¢ƒã€‚</p><h2 id="ç‚ºä»€éº¼è¦ä½¿ç”¨é ç«¯é–‹ç™¼ï¼Ÿ"><a class="header-anchor" href="#ç‚ºä»€éº¼è¦ä½¿ç”¨é ç«¯é–‹ç™¼ï¼Ÿ"></a>ç‚ºä»€éº¼è¦ä½¿ç”¨é ç«¯é–‹ç™¼ï¼Ÿ</h2><p>å‡è¨­ä½¿ç”¨é€™å€‹é–‹ç™¼ä¸­çš„ application æœªä¾†ä¹Ÿæœƒ deploy åœ¨ k8s cluster ä¸Šï¼Œé ç«¯é–‹ç™¼å¯ä»¥æä¾›ä»¥ä¸‹å¥½è™•ï¼š</p><ul><li>ä¸ç”¨å†å¤šæº–å‚™ä¸€ä»½å·®å¾ˆå¤§ local configï¼šåœ¨é–‹ç™¼æ™‚å¯ä»¥ç›´æ¥ä½¿ç”¨ cluster configï¼ˆå„˜ç®¡é€™ä»½ config å¯èƒ½æ˜¯ dev ç’°å¢ƒçš„ï¼Œé€šå¸¸ä¹Ÿæœƒæ¯” local config æ›´æ¥è¿‘ production ç’°å¢ƒï¼‰ã€‚</li><li>è‹¥é–‹ç™¼çš„ application ä¾è³´æ–¼ k8s å…§çš„å¤šå€‹å…¶ä»– serviceï¼Œç›´æ¥åœ¨ cluster å…§é–‹ç™¼å¯ä»¥çœå»å¾ˆå¤šé¡å¤–çš„ port forward è¨­å®šã€‚</li><li>é‚ªæƒ¡ debug ä¹‹è¡“ ğŸ˜ˆï¼šè‹¥ä½¿ç”¨é‹è¡Œä¸­çš„ deployment çš„åç¨±ä¾†å»ºç«‹ç’°å¢ƒï¼Œå‰‡ Okteto æœƒæš«æ™‚å–ä»£æ‰åŸæœ¬çš„ deploymentï¼Œé–‹ç™¼çµæŸæ‰æ›å›ä¾†ï¼ˆåƒè¬åˆ¥ç”¨åœ¨ production ç’°å¢ƒï¼Œé™¤éä½ ç™¾åˆ†ä¹‹å…©å„„çŸ¥é“è‡ªå·±åœ¨åšä»€éº¼ã€‚)</li></ul><p>æ¥ä¸‹ä¾†å°±é–‹å§‹æ‰‹æŠŠæ‰‹è¬›è§£å¦‚ä½•å»ºç«‹ä¸€å€‹ Kubernetes å…§é–‹ç™¼ç’°å¢ƒã€‚</p><h2 id="è¨­å®šæµç¨‹"><a class="header-anchor" href="#è¨­å®šæµç¨‹"></a>è¨­å®šæµç¨‹</h2><h3 id="Step-1-æº–å‚™ä¸€å€‹-K8S-Cluster"><a class="header-anchor" href="#Step-1-æº–å‚™ä¸€å€‹-K8S-Cluster"></a>Step 1: æº–å‚™ä¸€å€‹ K8S Cluster</h3><p>è¦è¨­å®š K8S é ç«¯é–‹ç™¼ï¼Œé¦–å…ˆè¦æº–å‚™ä¸€å€‹ä½ æœ‰æ¬Šé™è·‘ <code>kubectl apply</code> çš„ K8S clusterã€‚</p><p>å¦‚æœæ²’æœ‰çš„è©±ï¼Œ<a href="https://cloud.okteto.com/#/login" target="_blank" rel="noopener">Okteto Cloud</a> æä¾›äº†å…è²»çš„ cluster å¯ä»¥ä½¿ç”¨ï¼Œåªè¦ä½¿ç”¨ GitHub å¸³è™Ÿè¨»å†Šå³å¯ã€‚ï¼ˆæœ¬æ–‡æ˜¯ä½¿ç”¨ Mac OS X ä¸Šçš„ Docker Desktop å…§å»ºçš„ Kubernetesï¼‰</p><h3 id="Step-2-å®‰è£-VS-Code-çš„-Remote-Kubernetes-Extension"><a class="header-anchor" href="#Step-2-å®‰è£-VS-Code-çš„-Remote-Kubernetes-Extension"></a>Step 2: å®‰è£ VS Code çš„ Remote - Kubernetes Extension</h3><p><a href="https://marketplace.visualstudio.com/items?itemName=okteto.remote-kubernetes" target="_blank" rel="noopener">Remote - Kubernetes</a></p><h3 id="Step-3-è¨­å®š-Okteto-yaml"><a class="header-anchor" href="#Step-3-è¨­å®š-Okteto-yaml"></a>Step 3: è¨­å®š Okteto.yaml</h3><p>å‡è¨­ç¾åœ¨åœ¨é–‹ç™¼ä¸€å€‹ Python çš„ hello-world å°ˆæ¡ˆï¼Œä½ éœ€è¦å»ºç«‹ä¸€å€‹ <code>hello-world/okteto.yml</code> æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># name æœƒæ˜¯é–‹ç™¼ç”¨çš„ deployment name</span><br><span class="line">name: hello-world</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ Okteto æä¾›çš„ Python Image</span><br><span class="line">image: okteto&#x2F;python:3-dev</span><br><span class="line"></span><br><span class="line">command: [&quot;bash&quot;]</span><br><span class="line"></span><br><span class="line"># Source Code æœƒè¢«åŒæ­¥è‡³é€™å€‹ dir</span><br><span class="line">workdir: &quot;&#x2F;opt&#x2F;src&#x2F;&quot;</span><br><span class="line"></span><br><span class="line"># è¨­å®šå°‡é ç«¯ port 5000 forward åˆ°æœ¬æ©Ÿ port 25000ï¼Œç­‰ç­‰æœƒç”¨åˆ°</span><br><span class="line">forward:</span><br><span class="line">  - 25000:5000</span><br></pre></td></tr></table></figure><h3 id="Step-3-å•Ÿå‹•é ç«¯é–‹ç™¼ç’°å¢ƒ"><a class="header-anchor" href="#Step-3-å•Ÿå‹•é ç«¯é–‹ç™¼ç’°å¢ƒ"></a>Step 3: å•Ÿå‹•é ç«¯é–‹ç™¼ç’°å¢ƒ</h3><p>æ¥è‘— Cmd + Shift + p é–‹å•Ÿ Command Palette ä½¿ç”¨ <code>Okteto: Up</code></p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/okteto-up.png" width="400px" title="Okteto Starting..."></div><p>å†é¸æ“‡ä½ å‰›å‰›å»ºç«‹çš„ <code>hello-world/okteto.yaml</code> è¨­å®šæª”ã€‚</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/okteto-select-manifest.png" width="400px" title="Okteto Starting..."></div><br/>é¸å®Œè¨­å®šæª”å¾Œ VS Code å³ä¸‹è§’æœƒè·³å‡ºæç¤ºæ­£åœ¨æº–å‚™ä½ çš„ Remote é–‹ç™¼ç’°å¢ƒï¼š<div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/okteto-starting.png" width="400px" title="Okteto Starting..."></div><p>ç’°å¢ƒå»ºç«‹å¥½å¾Œ terminal æœƒé¡¯ç¤ºä»¥ä¸‹è¨Šæ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> âœ“  Development container activated</span><br><span class="line"> âœ“  Files synchronized</span><br><span class="line">    Namespace: default</span><br><span class="line">    Name:      python-okteto-sample</span><br><span class="line">    SSH:       22100 -&gt; 2222</span><br><span class="line">    Forward:   25000 -&gt; 5000</span><br><span class="line"></span><br><span class="line">Welcome to your development environment. Happy coding!</span><br><span class="line">okteto&gt;</span><br></pre></td></tr></table></figure><p>åŒæ™‚ VS Code æœƒé–‹å•Ÿä¸€å€‹æ–°çš„è¦–çª—ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢ä¸­é–“çš„æ¨™é¡Œèˆ‡å·¦ä¸‹ç‹€æ…‹éƒ½æœ‰æ¨™è¨˜ [SSH: XXX.okteto] ä»£è¡¨é€™å€‹è¦–çª—æ˜¯é ç«¯ç’°å¢ƒï¼š</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/vscode-remote-welcome.png" width="800px" title="Okteto Starting..."></div><h3 id="Step-4-è¨­å®š-Python-ç’°å¢ƒ"><a class="header-anchor" href="#Step-4-è¨­å®š-Python-ç’°å¢ƒ"></a>Step 4: è¨­å®š Python ç’°å¢ƒ</h3><p>ç”±æ–¼é€™å€‹é ç«¯æ˜¯ä¸€å€‹ä¹¾æ·¨ç’°å¢ƒï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å®‰è£ Python é–‹ç™¼å¥—ä»¶ä¸¦ reloadã€‚</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/vscode-install-python-small.png" width="400px" title="Okteto Starting..."></div><p>æ¥è‘—é¸æ“‡ Debugger è¦ä½¿ç”¨çš„ Python Interpreterï¼ŒOkteto é è¨­æœƒå¹«ä½ é–‹ä¸€å€‹ python <code>venv</code> è³‡æ–™å¤¾ï¼Œä½†å¦‚æœåœ¨ TERMINAL ä¸‹ <code>which python</code> æœƒç™¼ç¾æ˜¯ä½¿ç”¨ <code>/usr/local/bin/python</code> è€Œé <code>venv/bin/python</code>ã€‚é€™é‚Šç‚ºäº†è®“ debugger æ–¹ä¾¿æŠ“åˆ° pip å®‰è£çš„å¥—ä»¶ï¼Œæˆ‘ç›´æ¥æŠŠ Interpreter è¨­å®šç‚º <code>/usr/local/bin/python</code>ã€‚</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/vscode-select-interpreter.png" width="800px" title="VS Code: select interpreter"></div><br><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/vscode-select-python-version.png" width="800px" title="VS Code: select interpreter"></div><p>æ¥è‘—ä½¿ç”¨ <code>Cmd +j</code> å«å‡º VS Code TERMINALï¼Œè·‘ <code>pip install Flask==1.1.2</code> å®‰è£ Flask</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/flask-install.png" width="800px" title="Install flask"></div><h3 id="Step-5-å»ºç«‹æ¸¬è©¦ç”¨çš„-Python-application"><a class="header-anchor" href="#Step-5-å»ºç«‹æ¸¬è©¦ç”¨çš„-Python-application"></a>Step 5: å»ºç«‹æ¸¬è©¦ç”¨çš„ Python application</h3><p>æ¥ä¸‹ä¾†ç”¨ Flask å»ºç«‹ä¸€å€‹ç°¡å–®çš„æ¸¬è©¦ appã€‚</p><p>å»ºç«‹ <code>app.py</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># app.py</span><br><span class="line"></span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;hello&quot;)</span><br><span class="line">def hello():</span><br><span class="line">    return &quot;World!&quot;</span><br></pre></td></tr></table></figure><p>å»ºç«‹ <code>.vscode/launch.json</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;0.2.0&quot;,</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Python: Flask&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;python&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            &quot;module&quot;: &quot;flask&quot;,</span><br><span class="line">            &quot;env&quot;: &#123;</span><br><span class="line">                &quot;FLASK_APP&quot;: &quot;app.py&quot;,</span><br><span class="line">                &quot;FLASK_ENV&quot;: &quot;development&quot;,</span><br><span class="line">                &quot;FLASK_DEBUG&quot;: &quot;0&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;args&quot;: [</span><br><span class="line">                &quot;run&quot;,</span><br><span class="line">                &quot;--no-debugger&quot;,</span><br><span class="line">                &quot;--no-reload&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¨­å®šå®Œäº†å°±å¯ä»¥ä½¿ç”¨ VS Code menu çš„ <code>Run -&gt; Start Debugging</code> æˆ– <code>F5</code> é–‹å§‹ debugã€‚<br>æ­¤æ™‚å¯ä»¥é †ä¾¿åœ¨ <code>line 7</code> è¨­å®šä¸€å€‹æ¸¬è©¦ç”¨çš„ä¸­æ–·é»ï¼š</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/python-run-success.png" width="800px" title="Install flask"></div><p>ç”±æ–¼ä¸€é–‹å§‹æœ‰è¨­å®šäº† Okteto æŠŠ remote çš„ <code>5000</code> port forward åˆ°æœ¬æ©Ÿçš„ <code>25000</code> portï¼Œç¾åœ¨å¯ä»¥å¾ <code>localhost:25000</code> æ¸¬è©¦å‰›å‰›å¯«çš„ <code>/hello</code> é€™å€‹ APIï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl http:&#x2F;&#x2F;localhost:25000&#x2F;hello</span><br></pre></td></tr></table></figure><p>å¦‚æœå‰›å‰›è¨­å®šäº†ä¸­æ–·é»ï¼Œæ‡‰è©²æœƒç™¼ç¾é€™å€‹ curl ä¸æœƒ returnã€‚åˆ‡å› remote VS Code è¦–çª—æœƒç™¼ç¾ä¸­æ–·é»è¢«æˆåŠŸè§¸ç™¼äº†ï¼š</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/python-breakpoint-success.png" width="800px" title="Install flask"></div><p>åˆ°é€™é‚Šå°±æˆåŠŸè¨­å®šä¸”æ¸¬è©¦æˆ‘å€‘çš„ Remote Python é–‹ç™¼ç’°å¢ƒäº† ğŸ‘</p><h2 id="Trouble-Shooting-ç–‘é›£æ’è§£"><a class="header-anchor" href="#Trouble-Shooting-ç–‘é›£æ’è§£"></a>Trouble Shooting ç–‘é›£æ’è§£</h2><p>ç­†è€…åœ¨ä½¿ç”¨<code>Remote - Kubernetes</code> é ç«¯é–‹ç™¼æ™‚ç¶“å¸¸é‡åˆ° <code>Okteto: Up</code> æŒ‡ä»¤å¤±æ•—ã€é€¾æ™‚ï¼Œæˆ–æ˜¯é›–ç„¶æŒ‡ä»¤æˆåŠŸï¼Œå»æ²’æœ‰é€£ä¸Šé ç«¯ç’°å¢ƒç­‰ç‹€æ³ï¼Œé€™æ™‚æœƒéœ€è¦åˆ†æ®µæª¢æŸ¥ç’°å¢ƒå•é¡Œã€‚</p><h3 id="å¯èƒ½æ€§ä¸€ï¼šé ç«¯ç’°å¢ƒåŠ-ssh-é€£ç·šæ­£å¸¸ï¼Œåªæ˜¯-VS-Code-æ²’æœ‰è‡ªå‹•é€£ä¸Š"><a class="header-anchor" href="#å¯èƒ½æ€§ä¸€ï¼šé ç«¯ç’°å¢ƒåŠ-ssh-é€£ç·šæ­£å¸¸ï¼Œåªæ˜¯-VS-Code-æ²’æœ‰è‡ªå‹•é€£ä¸Š"></a>å¯èƒ½æ€§ä¸€ï¼šé ç«¯ç’°å¢ƒåŠ ssh é€£ç·šæ­£å¸¸ï¼Œåªæ˜¯ VS Code æ²’æœ‰è‡ªå‹•é€£ä¸Š</h3><p>é€™æ™‚å¯ä»¥å…ˆè©¦è‘—ä½¿ç”¨ Remote-SSH é€£å›é ç«¯ã€‚<code>Cmd + Shift + P</code> é–‹å•Ÿ Command Paletteï¼Œé¸æ“‡ <code>Remote-SSH: Connect to Host</code>ï¼š</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/remote-ssh-connect.png" width="400px" title="Install flask"></div><p>å†é¸æ“‡è¦é€£ç·šçš„é ç«¯ç’°å¢ƒï¼š</p><div style="width:100%; text-align:center;"><img src="/blog/2020/06/21/okteto-vscode-python/remote-ssh-select-host.png" width="400px" title="Install flask"></div><h3 id="å¯èƒ½æ€§äºŒï¼šSSH-é€£ç·šå¤±æ•ˆ"><a class="header-anchor" href="#å¯èƒ½æ€§äºŒï¼šSSH-é€£ç·šå¤±æ•ˆ"></a>å¯èƒ½æ€§äºŒï¼šSSH é€£ç·šå¤±æ•ˆ</h3><p>è‹¥ç›´æ¥ä½¿ç”¨ Remote-SSH ç„¡æ³•é€£å›é ç«¯ï¼Œå‰‡éœ€ä½¿ç”¨ <code>Okteto: Down</code> Deactivate ç›®å‰ç’°å¢ƒï¼Œå†ç”¨ <code>Okteto: Up</code> é‡é–‹ã€‚æœ‰æ™‚å€™æœƒç™¼ç”Ÿ <code>Okteto: Down</code> é¡¯ç¤ºæˆåŠŸï¼Œä½† <code>Okteto: Up</code> å¤±æ•—çš„ç‹€æ³ï¼Œå¿…é ˆå¤šè·‘å¹¾æ¬¡å¾Œæ‰èƒ½å†æ¬¡ä½¿ç”¨ <code>Okteto: Up</code>ã€‚</p><h3 id="å¯èƒ½æ€§ä¸‰ï¼šå…¶ä»–-Okteto-Error"><a class="header-anchor" href="#å¯èƒ½æ€§ä¸‰ï¼šå…¶ä»–-Okteto-Error"></a>å¯èƒ½æ€§ä¸‰ï¼šå…¶ä»– Okteto Error</h3><p>Okteto é è¨­æœƒå¯« log é€² <code>~/.okteto/okteto.log</code>ï¼Œå¯ä»¥çœ‹åˆ°è©³ç´°çš„éŒ¯èª¤è¨Šæ¯ï¼Œè¦‹æ‹›æ‹†æ‹›ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail ~&#x2F;.okteto&#x2F;okteto.log</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–è¨­å®šæ–¹å¼"><a class="header-anchor" href="#å…¶ä»–è¨­å®šæ–¹å¼"></a>å…¶ä»–è¨­å®šæ–¹å¼</h2><p>æˆ‘è‡ªå·±æ¸¬è©¦æœ‰ä¸€éƒ¨åˆ†çš„å•é¡Œæ˜¯ä¾†è‡ªæ–¼ <code>Remote - Kubernetes</code> é€™å€‹æ’ä»¶æ²’æœ‰æ­£ç¢ºçš„ launch é ç«¯ç’°å¢ƒæˆ–è¨­å®š portã€‚</p><p>å¦å¤– <code>Remote - Kubernetes</code> æœ‰å¦ä¸€å€‹å¾ˆå¤§çš„é™åˆ¶æ˜¯ä¸€æ¬¡åªèƒ½ launch ä¸€å€‹é ç«¯é–‹ç™¼ç’°å¢ƒ (GitHub ä¸Šæœ‰ç™¼ç›¸é—œçš„ <a href="https://github.com/okteto/remote-kubernetes/issues/101" target="_blank" rel="noopener">issue</a>)ã€‚æˆ‘è§€å¯Ÿé€™æ˜¯å› ç‚º <code>Okteto: Up</code> é€™å€‹æŒ‡ä»¤åœ¨ command line å¯«æ­»äº† <code>--remote 22100</code>ï¼Œå³ä½¿åœ¨ <code>okteto.yml</code> è¨­å®šäº†åˆ¥çš„ <code>remote</code>ï¼ŒVS Code æ’ä»¶é€™é‚Šä¹Ÿæœƒç›´æ¥ç„¡è¦–ï¼Œå¸Œæœ›ä¹‹å¾Œå®˜æ–¹æœƒè™•ç†é€™å€‹ bugã€‚</p><p>å› ç‚ºä¸Šè¿°çš„ç¨®ç¨®ä¸ç©©å•é¡Œï¼Œæˆ‘ç¾åœ¨éƒ½æ˜¯è‡ªå·±åˆ†å…©æ®µè¨­å®šï¼š</p><ol><li>ç›´æ¥ç”¨ <a href="https://okteto.com/docs/reference/cli/index.html" target="_blank" rel="noopener">Okteto CLI</a>ï¼Œå…ˆåœ¨ terminal ä¸‹  <code>okteto up -f ./okteto.yml</code> ç¢ºå®šç’°å¢ƒæˆåŠŸè·‘èµ·</li><li>å†ç”¨ <code>VS Code Remote SSH</code> é€£ä¸Šé ç«¯ç’°å¢ƒï¼ˆä¹Ÿå°±æ˜¯ trouble shooting #1 çš„æ–¹å¼ã€‚ï¼‰</li></ol><p>å…©æ®µå¼ç”¨æ³•æœ‰ä¸€å€‹æ¯”è¼ƒç›´æ¥çš„ç¼ºé»æ˜¯ï¼Œé€£ä¸Šé ç«¯å¾Œ VS Code ä¸æœƒè‡ªå‹• cd é€² <code>okteto.yml</code> è£¡è¨­å®šçš„ <code>workdir</code>ï¼Œè€Œæ˜¯æœƒé€²åˆ° <code>/root/</code>ï¼Œè¦è‡ªå·±å¾ VS Code Side Bar å†åˆ‡éå»ã€‚</p><p>è€Œå‰é¢ä¹Ÿæœ‰èªªéå…¶å¯¦ <code>Remote - Kubernetes</code> å°±æ˜¯ <code>Okteto</code> + <code>Remote-SSH</code>ï¼Œæ‰€ä»¥è‹¥æ¡ç”¨äº†é€™å€‹å…©æ®µå¼ç”¨æ³•ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç›´æ¥ç§»é™¤ <code>Remote - Kubernetes</code> äº† XDDD<br><br/></p><h2 id="çµèª"><a class="header-anchor" href="#çµèª"></a>çµèª</h2><p>æœ¬æ–‡ç°¡å–®ä»‹ç´¹äº†å¦‚ä½•ä½¿ç”¨ Okteto çš„ <code>Remote - Kubernetes</code> VS Code extension ä¾†å»ºç«‹ Kubernetes ä¸­çš„ Python é–‹ç™¼ç’°å¢ƒã€‚</p><p>é™¤äº†æœ¬æ–‡ä»‹ç´¹çš„éƒ¨åˆ†ä»¥å¤–ï¼ŒOkteto å…¶å¯¦æœ‰æä¾›äº†æ›´å¤šçš„é¸é …å¯ä»¥è¨­å®šï¼ŒåŒ…å«äº†è¨­å®šç’°å¢ƒè®Šæ•¸ã€é™åˆ¶ resourcesã€è¨­å®šå¤šå€‹ portã€ã€è¨­å®š secrets åŠ PersistentVolume ç­‰ç­‰ï¼Œè©³ç´°å¯ä»¥çœ‹å®˜æ–¹çš„ <a href="https://okteto.com/docs/reference/manifest/index.html" target="_blank" rel="noopener">Manifest Reference</a></p><p>é ç«¯é–‹ç™¼å°ç›¸ä¾æ–¼ K8S cluster çš„ application ä¾†èªªç›¸ç•¶æ–¹ä¾¿ï¼Œä½†å› ç‚ºéœ€è¦äº‹å‰è¨­å®šï¼Œæˆ‘è‡ªå·±é–‹ç™¼ API æ™‚é‚„æ˜¯æœƒå…ˆä»¥æœ¬æ©Ÿé–‹ç™¼ + fake data ç‚ºä¸»ï¼Œç›´åˆ°ä¸»è¦é‚è¼¯é–‹ç™¼å®Œç•¢å¾Œæ‰æ”¾ä¸Š development cluster æ¸¬è©¦ï¼Œä¸¦æ­é…ä¸­æ–·é»å¿«é€Ÿä¿®æ­£æ—©æœŸå•é¡Œã€‚ä½†åŒäº‹ä¹Ÿæœ‰äººæ˜¯ä»¥ Remote é–‹ç™¼ç‚ºä¸»ï¼ˆè«‹æ­é… <a href="https://okteto.com/docs/reference/manifest/index.html#persistentvolume-object-optional" target="_blank" rel="noopener">persistentVolume</a> è¨­å®šæœç”¨ï¼Œå¦å‰‡æ¯æ¬¡å…‰ Sync files å°±è¦ç­‰åŠå¤©â€¦ï¼‰ã€‚æœ¬æ©Ÿèˆ‡é ç«¯é–‹ç™¼çš„é¸æ“‡å¾ˆçœ‹å€‹äººåå¥½ï¼Œç”¨çš„é †æ‰‹æœ€é‡è¦å›‰ã€‚</p><h2 id="åƒè€ƒè³‡æ–™"><a class="header-anchor" href="#åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul><li><a href="https://medium.com/okteto/remote-kubernetes-development-in-visual-studio-code-with-okteto-8b96015b41a6" target="_blank" rel="noopener">Remote Kubernetes Development in Visual Studio Code with Okteto (Golang)</a></li><li><a href="https://okteto.com/blog/how-to-develop-python-apps-in-kubernetes/" target="_blank" rel="noopener">How to Develop and Debug Python Applications in Kubernetes (using PyCharm)</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=okteto.remote-kubernetes" target="_blank" rel="noopener">VS Code Remote - Kubernetes</a></li><li><a href="https://code.visualstudio.com/docs/remote/ssh" target="_blank" rel="noopener">VS Code Remote - SSH</a></li><li><a href="https://okteto.com/docs/reference/manifest/index.html" target="_blank" rel="noopener">Okteto Manifest Reference</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ VS Code ä¸Šçš„ &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=okteto.remote-kubernetes&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Python 3.9 æœ‰å“ªäº›æ–°ç©æ„ï¼Ÿ</title>
    <link href="http://yoursite.com/2020/06/20/whats-new-in-python-39/"/>
    <id>http://yoursite.com/2020/06/20/whats-new-in-python-39/</id>
    <published>2020-06-20T15:41:08.000Z</published>
    <updated>2020-07-26T22:13:20.781Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://docs.python.org/3.9/whatsnew/3.9.html" target="_blank" rel="noopener">Python 3.9</a> å³å°‡åœ¨ä»Šå¹´ 10 æœˆåˆ releaseï¼Œæœ¬æ–‡ä»‹ç´¹ä¸€äº› Python 3.9 çš„æ–°æ±è¥¿ã€‚</p><h2 id="New-Features"><a class="header-anchor" href="#New-Features"></a>New Features</h2><h3 id="Dictionary-Merge-Update-Operators"><a class="header-anchor" href="#Dictionary-Merge-Update-Operators"></a>Dictionary Merge &amp; Update Operators</h3><p>Dictionary å¼•é€²æ–°çš„ operator <code>|</code>ï¼Œå¯ä»¥æ–¹ä¾¿çš„ merge èˆ‡ update dictionaryã€‚<br>ä»¥ä¸‹ç¯„ä¾‹æ‰£æ¯”è¼ƒæ–°èˆŠèªæ³•çš„å·®ç•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; &#123;&quot;a_key&quot;: &quot;a_value&quot;&#125;</span><br><span class="line">b &#x3D; &#123;&quot;b_key&quot;: &quot;b_value&quot;&#125;</span><br><span class="line"></span><br><span class="line"># Before 3.9</span><br><span class="line">merged &#x3D; &#123;**a, **b&#125;</span><br><span class="line"></span><br><span class="line"># &gt;&#x3D; 3.9</span><br><span class="line">merged &#x3D; a | b</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è¦æŠŠ dict b çš„å…§å®¹ update é€² dict aï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Before 3.9</span><br><span class="line">a.update(b)  # a çš„å…§å®¹è¢«æ›´æ–°ï¼Œupdate() return None</span><br><span class="line"></span><br><span class="line"># &gt;&#x3D; 3.9</span><br><span class="line">a |&#x3D; b</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ–°çš„èªæ³•æ›´åŠ ä¹¾æ·¨ç›´è¦ºã€‚</p><h3 id="Typing-Builtin-Generic-Types-PEP-585"><a class="header-anchor" href="#Typing-Builtin-Generic-Types-PEP-585"></a>Typing: Builtin Generic Types <a href="https://www.python.org/dev/peps/pep-0585/" target="_blank" rel="noopener">(PEP 585)</a></h3><p>åè©å®šç¾©ï¼š</p><ul><li>Generic æŒ‡çš„æ˜¯å¯ä»¥è¢«åƒæ•¸åŒ–çš„å‹åˆ¥ï¼Œé€šå¸¸æ˜¯å®¹å™¨ï¼Œç”¨ <code>Dict</code>, <code>List</code> ä¾†æƒ³åƒå°±å¯ä»¥äº†ã€‚</li><li>Parameterized Generic å°±æ˜¯å·²æŒ‡å®šåƒæ•¸çš„ Genericï¼Œä¾‹å¦‚ <code>Dict[str, int]</code>ã€‚</li></ul><p>åŸæœ¬åœ¨åš typing hint æ™‚ï¼Œæœƒéœ€è¦å¾ typing module é¡å¤– import å¤§å¯«çš„ <code>Dict</code>, <code>Tuple</code>, <code>List</code> æˆ– <code>Set</code> ä¾†å®£å‘Šä½ éœ€è¦çš„ Parameterized Genericã€‚é€™æ˜¯å› ç‚º builtin çš„å°å¯« <code>list</code>, <code>dict</code> ä¸å…·å‚™ Generic çš„åŠŸèƒ½ï¼ˆä½¿ç”¨ <code>list[str]</code> æœƒå ± <code>TypeError: 'type' object is not subscriptable</code>ã€‚ï¼‰</p><p>åœ¨ Python 3.7 å¾Œå¯ä»¥è—‰ç”± <code>from __future__ import annotations</code> ä¾†ä½¿ç”¨ <code>list[str]</code>ã€‚</p><p>è€Œé€™æ¬¡åœ¨ Python 3.9 å¾Œå°±æ˜¯ç›´æ¥åŸç”Ÿæ”¯æ´äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Before 3.7 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; #</span><br><span class="line"></span><br><span class="line">from typing import List</span><br><span class="line"></span><br><span class="line">def method() -&gt; List[str]:</span><br><span class="line">    return [&quot;hola&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Python 3.7 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; #</span><br><span class="line"></span><br><span class="line">from __future__ import annotations</span><br><span class="line"></span><br><span class="line">def method() -&gt; list[str]:</span><br><span class="line">    return [&quot;hola&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Python 3.9 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; #</span><br><span class="line"></span><br><span class="line">def method() -&gt; list[str]:</span><br><span class="line">    return [&quot;hola&quot;]</span><br></pre></td></tr></table></figure><p>é€™æ¬¡æ›´æ–°ä»¥å¾Œå°å¯«çš„ <code>tuple</code>, <code>list</code>, <code>dict</code>, <code>set</code>, <code>frozenset</code>, <code>type</code> ç­‰ç­‰éƒ½åŸç”Ÿæ”¯æ´ Generic äº†ï¼Œè©³ç´°åˆ—è¡¨å¯ä»¥åƒè€ƒ<a href="https://www.python.org/dev/peps/pep-0585/#implementation" target="_blank" rel="noopener">é€™è£¡</a>ã€‚</p><p>æˆ‘è‡ªå·±åŸæœ¬çš„ç”¨æ³•æ˜¯ï¼Œéœ€è¦ Generic æ™‚æ‰ import å¤§å¯«ï¼Œä¸éœ€ Generic æ™‚ç”¨åŸç”Ÿå°å¯«ã€‚ä½†æ™‚å¸¸ç™¼ PR æ™‚æœƒè¢« comment èª¬è«‹æ”¹ç”¨å¤§å¯«çš„ï¼ˆå› ç‚ºå…¬å¸æ²’æœ‰æ˜ç¢ºè¦ç¯„ typing é€™é‚Šçš„ styleï¼‰ï¼Œä¸éé€™ç‰ˆä»¥å¾Œå…¨éƒ½å°å¯«å°±å¥½å›‰ã€‚</p><h3 id="String-removeprefix-removesuffix"><a class="header-anchor" href="#String-removeprefix-removesuffix"></a>String: removeprefix, removesuffix</h3><p>String å¤šäº†å…©å€‹å° helper functionï¼Œå¯ä»¥æ‹¿ä¾†è™•ç†ç§»é™¤å‰ç¶´å¾Œç¶´ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;TestHook&quot;.removeprefix(&quot;Test&quot;)  # &#x3D;&gt; &quot;Hook&quot;</span><br><span class="line">&quot;BaseTestCase&quot;.removeprefix(&quot;Test&quot;) # &#x3D;&gt; &quot;BaseTestCase&quot;</span><br><span class="line"></span><br><span class="line">&quot;MiscTests&quot;.removesuffix(&quot;Tests&quot;) # &#x3D;&gt; &quot;Misc&quot;</span><br><span class="line">&quot;TmpDirMixin&quot;.removesuffix(&quot;Tests&quot;) # &#x3D;&gt; &quot;TmpDirMixin&quot;</span><br></pre></td></tr></table></figure><h3 id="Decorator-Syntax-Update-PEP-614"><a class="header-anchor" href="#Decorator-Syntax-Update-PEP-614"></a>Decorator Syntax Update <a href="https://www.python.org/dev/peps/pep-0614/" target="_blank" rel="noopener">(PEP 614)</a></h3><p>é€™å€‹æ”¹å‹•æ”¾å¯¬äº† decorator çš„èªæ³•é™åˆ¶ã€‚ç›®å‰ decorator çš„èªæ³•è£¡é¢ä¸èƒ½å¸¶å¤ªå¤šçš„ expressionï¼Œä»¥ä¸‹æ˜¯ PEP è£¡é¢çµ¦å‡ºçš„ PyQt ç¯„ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">buttons &#x3D; [QPushButton(f&#39;Button &#123;i&#125;&#39;) for i in range(10)]</span><br><span class="line"></span><br><span class="line"># Do stuff with the list of buttons...</span><br><span class="line"></span><br><span class="line">@buttons[0].clicked.connect</span><br><span class="line">def spam():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„èªæ³•æ˜¯ä¸åˆæ³•çš„ï¼Œå¿…é ˆæ”¹å¯«ç‚ºä»¥ä¸‹æ‰èƒ½å‹•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">button_0 &#x3D; buttons[0]</span><br><span class="line"></span><br><span class="line">@button_0.clicked.connect</span><br><span class="line">def spam():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>ä½†ç¥å¥‡çš„æ˜¯å¯ä»¥ä½¿ç”¨ä¸€äº› hack ä¾†é”æˆåœ¨ decorator ä½¿ç”¨è¤‡é›œçš„ expressionï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Hack option 1: Identity function:</span><br><span class="line"></span><br><span class="line">def _(x):</span><br><span class="line">    return x</span><br><span class="line"></span><br><span class="line">@_(buttons[0].clicked.connect)</span><br><span class="line">def spam():</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"># Hack option 2: eval:</span><br><span class="line"></span><br><span class="line">@eval(&quot;buttons[1].clicked.connect&quot;)</span><br><span class="line">def eggs():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>PEP 614 ä¸­æœ‰æåˆ°ï¼Œé›–ç„¶ motivation ç¯„ä¾‹çš„éœ€æ±‚æ˜¯ subscriptingï¼ˆi.e. ä½¿ç”¨ <code>[0]</code> å–ç”¨ï¼‰ï¼Œä½†èˆ‡å…¶éš¨æ„æ”¾å¯¬å–®ä¸€èªæ³•ï¼Œä¸å¦‚ç›´æ¥æ”¾å¯¬åˆ°å…è¨± <code>expression</code>ã€‚åœ¨é€™è£¡çš„ <code>expression</code> æŒ‡çš„æ˜¯ä»»ä½•å¯ä»¥æ”¾åœ¨ <code>if</code>, <code>elif</code> æˆ– <code>while</code> è£¡åšåˆ¤æ–·çš„æ±è¥¿ã€‚</p><p>ç¸½ä¹‹ä»¥ä¸Šé¢çš„ç¯„ä¾‹ä¾†èªªï¼Œä»¥å¾Œå¯ä»¥ç›´æ¥å¯«æˆé€™æ¨£äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">buttons &#x3D; [QPushButton(f&#39;Button &#123;i&#125;&#39;) for i in range(10)]</span><br><span class="line"></span><br><span class="line">@buttons[0].clicked.connect</span><br><span class="line">def spam():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h2 id="New-Updated-Module"><a class="header-anchor" href="#New-Updated-Module"></a>New / Updated Module</h2><h3 id="zoneinfo-PEP-615"><a class="header-anchor" href="#zoneinfo-PEP-615"></a>zoneinfo <a href="https://www.python.org/dev/peps/pep-0615/" target="_blank" rel="noopener">(PEP 615)</a></h3><p>zoneinfo é€™å€‹ module åœ¨ Python 3.9 è¢«åŠ å…¥äº† standard modules è£¡é¢ã€‚</p><p>ä»¥å‰åœ¨å°ç£å·¥ä½œæ™‚å…¶å¯¦å¾ˆå°‘éœ€è¦è™•ç†æ™‚å€å•é¡Œï¼Œåªè¦æŠŠæ¡å¥½ server side éƒ½ç”¨ timestamp æˆ– UTC timeï¼Œé¡¯ç¤ºæ™‚é–“ã€è½‰æ›æ ¼å¼éƒ½åœ¨ client side è™•ç†çš„åŸå‰‡ï¼Œå¹¾ä¹æ²’æœ‰å‡ºéå•é¡Œã€‚</p><p>è€Œç¾åœ¨åœ¨å€«æ•¦çš„å·¥ä½œæœ‰å¤§é‡çš„ timezone å•é¡Œéœ€è¦è™•ç†ã€‚ä¸»è¦åŸå› æ˜¯è‹±åœ‹æœ‰æ—¥å…‰ç¯€ç´„æ™‚é–“ï¼Œå†¬å­£æ˜¯ GMT+0ã€å¤å­£æ˜¯ GMT+1ï¼ŒåŠ ä¸Šåœ¨èƒ½æºç”¢æ¥­ï¼Œé›–ç„¶å…¬å¸æ˜¯æ–°å‰µå…¬å¸ï¼Œä½†æœ‰å¤§é‡è³‡æ–™è¦è·Ÿæ¥­ç•ŒèˆŠçš„ç³»çµ±æˆ–äººå·¥æ¥­å‹™å°æ¥ï¼Œå°è‡´è¨±å¤š input data çš„æ™‚é–“éƒ½æ˜¯ç”¨ local timeï¼ŒåŒå€‹ time string <code>13:00</code> åœ¨å¤å­£è·Ÿå†¬å­£æœƒä½¿ç”¨ä¸åŒçš„ timezone offsetã€‚æœ€è¦å‘½çš„æ˜¯ï¼Œåœ¨é€²å…¥å†¬å­£çš„ clock change day æ™‚ï¼Œæ™‚é˜æœƒå¾€å›èª¿ï¼Œæ‰€ä»¥é€™å¤©çš„ local time æœƒæœ‰å…©ç¨® <code>02:00</code>ã€‚</p><p>ç‚ºäº†è™•ç†æ™‚å€ï¼Œç›®å‰å…¬å¸ç”¨çš„æ˜¯ <code>pytz</code> é€™å€‹ moduleï¼Œæœªä¾†å‡ç´š Python 3.9 æ™‚æ”¹ç”¨ <code>zoneinfo</code> å°±ä¸ç”¨é¡å¤–å®‰è£äº†ã€‚å¦å¤–<a href="https://www.python.org/dev/peps/pep-0615/#using-a-pytz-like-interface" target="_blank" rel="noopener">é€™è£¡</a> ä¹Ÿè¨è«–äº†ç‚ºä»€éº¼æ˜¯æ”¾ <code>zoneinfo</code> é€² standard è€Œä¸æ˜¯ <code>pytz</code>ã€‚</p><h2 id="New-Parser-PEP-617"><a class="header-anchor" href="#New-Parser-PEP-617"></a>New Parser <a href="https://www.python.org/dev/peps/pep-0617/" target="_blank" rel="noopener">(PEP 617)</a></h2><p>Python 3.9  æŠŠ CPython çš„ LL(1) parser æ›æˆ PEG parserã€‚</p><p>æ–‡ä»¶è£¡å¯«åˆ° PEG parser çš„æ•ˆèƒ½è·ŸåŸæœ¬çš„ parser å·®ä¸å¤šï¼Œä¸¦ä¸”æœƒç”Ÿæˆä¸€æ¨£çš„ ASTã€‚é€™å€‹æ”¹å‹•å¾ä½¿ç”¨è€…è§’åº¦ä¸Šæ‡‰è©²æ„Ÿå—ä¸åˆ°å·®ç•°ï¼Œä¸»è¦ç›®çš„æ˜¯åœ¨é–‹ç™¼èªè¨€çš„æ–° feature æ™‚ï¼ŒPEG parser æä¾›äº†æ›´å¤šçš„å½ˆæ€§ã€‚è€Œ PEP 617 ä¹Ÿæåˆ°äº†æœ¬ä¾†ä»–å€‘æœ‰å° LL(1) parser åšäº†ä¸€äº› hackï¼Œæ”¹ç”¨ PEG parser å¾Œå°±ä¸ç”¨ç¹¼çºŒ maintain é€™äº› hack äº†ã€‚</p><h2 id="çµèª"><a class="header-anchor" href="#çµèª"></a>çµèª</h2><p>ä»¥ä¸Šæ˜¯ç­†è€…å¾è‡ªå·±çš„è§’åº¦æ•´ç†å‡º Python 3.9 æ¯”è¼ƒå€¼å¾—ä¸€æçš„æ–°åŠŸèƒ½ï¼Œä½†ç•¶ç„¶ä¹Ÿå¯èƒ½æœ‰äº›æˆ‘æ²’æœ‰ç”¨åˆ°çš„ feature å°åˆ¥äººä¾†èªªå…¶å¯¦æ˜¯å¾ˆé‡è¦çš„æ”¹å‹•ï¼Œæ‰€ä»¥ä¸€æ¨£æ¨è–¦ç›´æ¥<a href="https://docs.python.org/3.9/whatsnew/3.9.html" target="_blank" rel="noopener">é–±è®€åŸæ–‡</a>ã€‚</p><p>ï¼ˆå¦å¤–å› ç‚ºå®˜æ–¹æ–‡ä»¶é‚„åœ¨è‰ç¨¿éšæ®µæ‰€ä»¥æœƒæŒçºŒæ›´æ–°ï¼Œå»ºè­° release æ™‚å¯ä»¥å†å›å»çœ‹ä¸€ä¸‹ã€‚ï¼‰</p><h2 id="Reference"><a class="header-anchor" href="#Reference"></a>Reference</h2><ul><li><a href="https://docs.python.org/3.9/whatsnew/3.9.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡ä»¶ï¼šWhatâ€™s New In Python 3.9</a></li><li><a href="https://www.python.org/dev/peps/pep-0585/" target="_blank" rel="noopener">PEP 585 â€“ Type Hinting Generics In Standard Collections</a></li><li><a href="https://www.python.org/dev/peps/pep-0614/" target="_blank" rel="noopener">PEP 614 â€“ Relaxing Grammar Restrictions On Decorators</a></li><li><a href="https://www.python.org/dev/peps/pep-0615/" target="_blank" rel="noopener">PEP 615 â€“ Support for the IANA Time Zone Database in the Standard Library</a></li><li><a href="https://www.python.org/dev/peps/pep-0617/" target="_blank" rel="noopener">PEP 617 â€“ New PEG parser for CPython</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://docs.python.org/3.9/whatsnew/3.9.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Python 3.9&lt;/a&gt; å³å°‡åœ¨ä»Šå¹´ 10 æœˆåˆ releaseï¼Œæœ¬æ–‡ä»‹ç´¹ä¸€äº› Python 3
      
    
    </summary>
    
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Python å°¬è¨­è¨ˆæ¨¡å¼ï¼šæ²’æœ‰ Interfaceï¼Œä½†æœ‰ abc</title>
    <link href="http://yoursite.com/2020/06/17/python-interface-use-abc/"/>
    <id>http://yoursite.com/2020/06/17/python-interface-use-abc/</id>
    <published>2020-06-17T22:07:34.000Z</published>
    <updated>2020-07-26T22:13:20.781Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ–‡ç« ç”¨ä¾†è¨˜éŒ„æˆ‘åœ¨å·¥ä½œä¸Šå¯« Python æ™‚ä½¿ç”¨ Design Pattern çš„ä¸€äº›å¿ƒå¾—ã€‚</p><p>Python ä¸æ˜¯ä¸€å€‹å…¸å‹çš„ OOP èªè¨€ï¼ˆç›¸å°æ–¼ Java è€Œè¨€ï¼‰ï¼Œè¦ç”¨ Python å¯« OOP æ™‚é›£å…æœ‰äº›å¡å¡çš„ã€‚å¦‚æœä½ è·Ÿæˆ‘ä¸€æ¨£å…ˆå¾åˆ¥çš„èªè¨€ï¼ˆJava, C++, â€¦ï¼‰å­¸é Design Pattern äº†ï¼Œç¾åœ¨æƒ³æŠŠçŸ¥è­˜æ‹‰åˆ° Python ç”¨å»ä¸çŸ¥é“å¾ä½•ä¸‹æ‰‹ï¼Œé€™ç¯‡æ–‡ç« å¯èƒ½æœƒå°ä½ æœ‰äº›å¹«åŠ©ã€‚</p><p>ï¼ˆå¦å¤–ï¼Œæœ¬æ–‡é è¨­è®€è€…å·²ç¶“æ‡‚ OOPã€Design Patternã€Interface èˆ‡ Pythonï¼‰<br>ï¼ˆå¦‚æœæ²’æœ‰å…ˆè¡ŒçŸ¥è­˜ï¼Œé€™ç¯‡æ–‡ç« å¯èƒ½æœƒè®“ä½ çœ‹å¾—å¾ˆæ··æ·†ï¼Œæ…å…¥ï¼ï¼‰</p><h2 id="Python-æ²’æœ‰-Interface"><a class="header-anchor" href="#Python-æ²’æœ‰-Interface"></a>Python æ²’æœ‰ Interface</h2><p>Design Pattern ç¶“å¸¸éœ€è¦ä½¿ç”¨ Interface ä¾†é”æˆå¤šå‹ã€‚Python åŸç”Ÿæ²’æœ‰ Interfaceï¼Œä½†é‚„æ˜¯æœ‰äº›æ–¹æ³•å¯ä»¥åšå‡º Interfaceã€‚</p><h3 id="Option-1-Interface-æ˜¯å•¥ï¼Ÿæˆ‘æœ‰å¤šé‡ç¹¼æ‰¿ï¼"><a class="header-anchor" href="#Option-1-Interface-æ˜¯å•¥ï¼Ÿæˆ‘æœ‰å¤šé‡ç¹¼æ‰¿ï¼"></a>Option 1: Interface æ˜¯å•¥ï¼Ÿæˆ‘æœ‰å¤šé‡ç¹¼æ‰¿ï¼</h3><p>Python å¯ä»¥å¤šé‡ç¹¼æ‰¿ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å¯«ä¸€å † class å«åš XxxInterfaceï¼Œç„¶å¾Œå¤šé‡ç¹¼æ‰¿é€™äº› class å°±å¥½ã€‚ä¸éé€™æ¨£çš„å¯«æ³•æœƒé‡ç”¨ Super class çš„å¯¦ä½œï¼Œè·Ÿ Interface çš„ä¸»åŠŸèƒ½ï¼šå®šç¾©éœ€è¦çš„ property/method/input/output è€Œä¸å¯¦ä½œï¼Œé‚„æ˜¯æœ‰ä¸€é»é»å·®ç•°ã€‚</p><h3 id="Option-2-abc-Abstract-Base-Class"><a class="header-anchor" href="#Option-2-abc-Abstract-Base-Class"></a>Option 2: abc (Abstract Base Class)</h3><p>è¦æ›´ fancy çš„è©±ï¼Œ ç”¨ abc é€™å€‹ <sub>åå­—æœ‰é»é¬§çš„</sub> module å¯ä»¥å¯«å‡ºæ›´æ¥è¿‘ â€œInterfaceâ€ çš„æ±è¥¿ã€‚</p><p>è¦å®šç¾©ä¸€å€‹ Interfaceï¼Œä½ éœ€è¦å¯«ä¸€å€‹ class ç¹¼æ‰¿ <code>abc.ABC</code>ï¼Œä¸¦æŠŠ <code>abstract method</code> è·Ÿ <code>abstract property</code> decorate å¥½ï¼Œé€™å°±æ˜¯ä½ çš„ Interfaceã€‚è¦å¯¦ä½œé€™å€‹ Interface æ™‚ç”¨ç¹¼æ‰¿çš„å°±å¥½ã€‚</p><p>ä»¥ä¸‹æ˜¯ç¯„ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import abc</span><br><span class="line"></span><br><span class="line"># å®šç¾© Interface</span><br><span class="line"></span><br><span class="line">class BookInterface(abc.ABC):</span><br><span class="line">    # å®šç¾© read-only property</span><br><span class="line">    @abstractproperty</span><br><span class="line">    def author(self):</span><br><span class="line">        return self.__author</span><br><span class="line"></span><br><span class="line">    # å®šç¾© read-write abstract property</span><br><span class="line">    def getp(self):</span><br><span class="line">        return self.__price</span><br><span class="line"></span><br><span class="line">    def setp(self, value):</span><br><span class="line">        self.__price &#x3D; value</span><br><span class="line"></span><br><span class="line">    price &#x3D; abc.abstractproperty(getp, setp)</span><br><span class="line"></span><br><span class="line">    # å®šç¾© abstract method</span><br><span class="line">    @abc.abstractmethod</span><br><span class="line">    def read(self):</span><br><span class="line">        print(&quot;Interface Impl&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç¹¼æ‰¿ï¼ˆå¯¦ä½œï¼‰ BookInterface</span><br><span class="line"></span><br><span class="line">class AmazonEbook(BookInterface):</span><br><span class="line">    @property</span><br><span class="line">    def price(self):</span><br><span class="line">        return self.__price</span><br><span class="line"></span><br><span class="line">    @price.setter</span><br><span class="line">    def price(self, value):</span><br><span class="line">        self.__price &#x3D; value</span><br><span class="line"></span><br><span class="line">    def read(self):</span><br><span class="line">        print(&quot;AmazonEbook read&quot;)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æŠ„èµ°å°±å¯ä»¥é–‹å§‹å¯« Interface å›‰ï¼</p><p>\OOP/ \Design Pattern/ \Polymorphism/ å°¬èµ·ä¾†ï¼</p><h4 id="Abstract-Base-Class-æä¾›çš„å¥½è™•"><a class="header-anchor" href="#Abstract-Base-Class-æä¾›çš„å¥½è™•"></a>Abstract BaseÂ Class æä¾›çš„å¥½è™•</h4><p>å¦‚å‰é¢æ‰€èªªï¼Œå¤šé‡ç¹¼æ‰¿å…¶å¯¦å°±å¯ä»¥è™•ç†åŸºæœ¬çš„ Interface å•é¡Œäº†ï¼Œè€Œç›¸å°æ–¼ç”¨å¤šé‡ç¹¼æ‰¿ç¡¬å°¬ï¼ŒABC é‚„å¤šæä¾›äº†ä»¥ä¸‹è¼”åŠ©ï¼š</p><ol><li><p>å¦‚æœå°‘ implement äº† abstract method æˆ– abstract propertyï¼ŒObject initialization æ™‚æœƒå ± <code>TypeError</code>ã€‚</p></li><li><p>ä½¿ç”¨ abc å¯ä»¥ overload <code>__subclasscheck__</code>, <code>__instancecheck__</code>ï¼Œè®“ä½ æœ‰æ©Ÿæœƒæ”¹è®Š <code>issubclass()</code> è·Ÿ  <code>isinstance()</code> çš„é è¨­è¡Œç‚ºã€‚</p></li></ol><p>å¦å¤–é‚„æœ‰äº›å¥½è™•å¯èƒ½è·Ÿ extend / implement ä¸€äº› built-in Type å¦‚ Sets, Sequences æœ‰é—œï¼Œä½†é€™éƒ¨åˆ†æˆ‘ä¸ç†Ÿæ‰€ä»¥å°±ä¸å¤šåšä»‹ç´¹ä»¥å…èª¤å°ï¼Œæœ‰èˆˆè¶£çš„äººå¯ä»¥çœ‹çœ‹ <a href="https://www.python.org/dev/peps/pep-3119/" target="_blank" rel="noopener">PEP 3119</a>ã€‚</p><h4 id="Abstract-Base-Class-ä¾èˆŠä¸æ˜¯-Interface"><a class="header-anchor" href="#Abstract-Base-Class-ä¾èˆŠä¸æ˜¯-Interface"></a>Abstract BaseÂ Class ä¾èˆŠä¸æ˜¯ Interface</h4><p>æ‹¿ abc ç•¶ Interface ç”¨ï¼Œå¯«ä¸€å¯«å¯èƒ½é‚„æ˜¯æœƒç™¼ç¾å“ªè£¡æ€ªæ€ªçš„ã€‚<br>é€™é‚Šåˆ—äº†ä¸€äº›å¾ Interface è½‰ä¾†çš„äººæœƒè¦ºå¾— abc</p><ol><li>å¦‚æœå°‘ implement äº†ä»€éº¼ methodï¼Œæœƒåˆ° init object æ‰å™´éŒ¯ã€‚é€™ç®—æ˜¯ Python çš„åŸç½ªï¼Œå¯ä»¥ä½¿ç”¨ Pylint ä¹‹é¡çš„ linter è‡ªå‹•æ‰¾å‡ºæ²’ implement çš„ method ä¾†è™•ç†æ‰é€™å€‹å•é¡Œã€‚</li><li>abstract method <strong><em>å¯ä»¥</em></strong> æœ‰ concrete implementationï¼Œä¸¦èƒ½ç”¨ super() å–ç”¨ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class SimpleInterface(abc.ABC):</span><br><span class="line">    @abc.abstractmethod</span><br><span class="line">    def method_a(self):</span><br><span class="line">        print(&quot;I&#39;m from an Interface.&quot;)</span><br><span class="line"></span><br><span class="line">class SimpleConcrete(SimpleInterface):</span><br><span class="line">    def method_a(self):</span><br><span class="line">        super().method_a()</span><br><span class="line"></span><br><span class="line">SimpleConcrete().method_a() # æœƒå°å‡º &quot;I&#39;m from an Interface.&quot;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>Implement abstract method æ™‚ï¼Œarguments åç¨±è·Ÿæ•¸é‡éƒ½å¯ä»¥ä¸ä¸€æ¨£ã€‚ï¼ˆä½†æœ‰çš„ linter æœƒæç¤ºä½ è«‹å–ä¸€æ¨£çš„åç¨±ï¼‰</p></li><li><p>ç”šè‡³ä¹Ÿ <strong><em>å¯ä»¥</em></strong> ç”¨ property implement method æˆ–ç”¨ method implement propertyã€‚<br>ï¼ˆç•¢ç«Ÿ Python æ˜¯ first class functionï¼Œå¤§å®¶éƒ½æ˜¯ objectï¼‰<br>ï¼ˆåªæ˜¯ call éŒ¯æ™‚é‚„æ˜¯æœƒå™´éŒ¯å°±æ˜¯äº†XDï¼‰</p></li></ol><h2 id="ä½†æˆ‘è½èªª-Python-æ˜¯-Duck-Typing-æ‰€ä»¥æ ¹æœ¬ä¸ç”¨-Interfaceï¼Ÿ"><a class="header-anchor" href="#ä½†æˆ‘è½èªª-Python-æ˜¯-Duck-Typing-æ‰€ä»¥æ ¹æœ¬ä¸ç”¨-Interfaceï¼Ÿ"></a>ä½†æˆ‘è½èªª Python æ˜¯ Duck Typing æ‰€ä»¥æ ¹æœ¬ä¸ç”¨ Interfaceï¼Ÿ</h2><p><a href="https://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="noopener">Duck Typing</a>ï¼ˆé´¨å­å‹åˆ¥ï¼‰çš„æ„æ€æ˜¯ï¼šã€Œç•¶çœ‹åˆ°ä¸€éš»é³¥èµ°èµ·ä¾†åƒé´¨å­ã€æ¸¸æ³³èµ·ä¾†åƒé´¨å­ã€å«èµ·ä¾†ä¹Ÿåƒé´¨å­ï¼Œé‚£éº¼é€™éš»é³¥å°±å¯ä»¥è¢«ç¨±ç‚ºé´¨å­ã€‚ã€<br>ä¹Ÿå°±æ˜¯èªªä¸€å€‹ class ä¸ç®¡ä»–å¯¦éš›ä¸Šç¹¼æ‰¿è‡ªå“ªï¼Œåªè¦æœ‰ç›¸æ‡‰çš„ method/propertyï¼ŒPython å°±å…è¨±é€™å€‹ class åˆ°è™• <sub>æ‹›æ–æ’é¨™</sub> è¢«ç•¶ä½œå…¶ä»–ç‰¹å®š class ä½¿ç”¨ã€‚</p><p>abc çš„ä½œè€…ä¹Ÿåœ¨ PEP-3119 æœ‰ä¸€æ®µ <a href="https://www.python.org/dev/peps/pep-3119/#abcs-vs-duck-typing" target="_blank" rel="noopener">ABCs v.s Duck Typing çš„è¨è«–</a>ã€‚å¤§æ„æ˜¯èªª abc ä¸æ˜¯æ‹¿ä¾†æ®ºå®³ Duck Typing çš„ã€‚å¾ˆå¤šæ™‚å€™åªè¦ä½¿ç”¨ <code>hasattr()</code> ä¾†åˆ¤æ–·éœ€è¦çš„ attribute å­˜åœ¨å°±å·²ç¶“å¯«çš„ 666 äº†ï¼Œé‚£å°±ä¸ä¸€å®šè¦ä½¿ç”¨ abcã€‚</p><p>å…¶å¯¦æˆ‘è‡ªå·±è¦ºå¾— Python çš„ Duck Typing è·Ÿå¤šé‡ç¹¼æ‰¿ï¼Œåˆèµ·ä¾†æ˜¯ self-contained çš„ä¸€å¥—äº†ã€‚è‡³å°‘åœ¨ 2007 å¹´ä»¥å‰ abc éƒ½ä¸å­˜åœ¨ï¼Œèˆ‡å…¶å°‹æ‰¾é¡ Interface çš„æ›¿ä»£å“ï¼Œä¸å¦‚æ·±å…¥äº†è§£ Python èªè¨€æœ¬èº«çš„å¼·é …/é™åˆ¶/ç†å¿µï¼Œä¾†æ‰¾å‡ºæƒ…å¢ƒä¸‹æœ€åˆé©çš„å¯«æ³•ã€‚é›–ç„¶æˆ‘åœ¨ä¸Šé¢åˆ—äº†ä¸€äº› abc æœƒè®“äººæ„Ÿåˆ°ã€Œæ€ªæ€ªçš„ã€é»ï¼Œä½†å†ç¨å¾®æ€è€ƒä¸€ä¸‹ï¼Œé‚£äº›é»éƒ½ä¸æ˜¯ abc æ•…æ„è¨­è¨ˆçš„ï¼Œè€Œæ˜¯ Python æœ¬èº«ç‰¹æ€§è‡ªç„¶é€ å°±çš„è€Œå·²ã€‚</p><p>å°±ç®—åˆ°ä»Šæ—¥ abc å·²ç¶“å¾ˆæˆç†Ÿï¼Œä½•æ™‚ä½¿ç”¨ abcã€å¦‚ä½•ä½¿ç”¨ä¹Ÿéƒ½è©²äº¤ç”±ä½¿ç”¨æƒ…å¢ƒä¾†æ±ºå®šï¼Œç¸½ä¹‹å°±æ˜¯æ²’æœ‰éŠ€å½ˆã€‚</p><p>æœ€å¾Œæ¨è–¦é–±è®€æœ¬æ–‡ä¸æ–·å‡ºç¾çš„ <a href="https://www.python.org/dev/peps/pep-3119/" target="_blank" rel="noopener">PEP-3119</a>ï¼Œé€™æ˜¯ç•¶åˆ Python ç¤¾ç¾¤æå‡º abc çš„ proposalã€‚è£¡é¢è©³ç´°å¯«äº†ç‚ºä»€éº¼è¦æœ‰ abcã€ç›¸é—œç”¨æ³•ä»¥åŠè·Ÿå…¶ä»– alternatives çš„æ¯”è¼ƒè¨è«–ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬ç¯‡æ–‡ç« ç”¨ä¾†è¨˜éŒ„æˆ‘åœ¨å·¥ä½œä¸Šå¯« Python æ™‚ä½¿ç”¨ Design Pattern çš„ä¸€äº›å¿ƒå¾—ã€‚&lt;/p&gt;
&lt;p&gt;Python ä¸æ˜¯ä¸€å€‹å…¸å‹çš„ OOP èªè¨€ï¼ˆç›¸å°æ–¼ Java è€Œè¨€ï¼‰ï¼Œè¦ç”¨ Python å¯« OOP æ™‚é›£å…æœ‰äº›å¡å¡çš„ã€‚å¦‚æœä½ è·Ÿæˆ‘ä¸€æ¨£å…ˆå¾åˆ¥çš„èªè¨€ï¼ˆJava, 
      
    
    </summary>
    
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="oop" scheme="http://yoursite.com/tags/oop/"/>
    
      <category term="design-pattern" scheme="http://yoursite.com/tags/design-pattern/"/>
    
  </entry>
  
</feed>
